<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BYTROX LUX</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #ffffff;
    height: 100%;
    font-family: Arial, sans-serif;
  }
  #chart {
    width: 100%;
    height: 100%;
  }
</style>

<script src="https://unpkg.com/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>

<script type="module">
  // ---------------- Firebase sozlamalari ----------------
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB1_XCbC777hKwxlilhMeq5Hpty1dvDT1I",
    authDomain: "giper-8fd92.firebaseapp.com",
    databaseURL: "https://giper-8fd92-default-rtdb.firebaseio.com",
    projectId: "giper-8fd92",
    storageBucket: "giper-8fd92.firebasestorage.app",
    messagingSenderId: "485740337398",
    appId: "1:485740337398:web:ab901fd4f28219ea5834d7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ---------------- Chart sozlamalari ----------------
  const chart = LightweightCharts.createChart(document.getElementById("chart"), {
    layout: {
      background: { color: "#ffffff" },
      textColor: "#333",
    },
    grid: {
      vertLines: { color: "rgba(230, 230, 230, 1)" },
      horzLines: { color: "rgba(230, 230, 230, 1)" },
    },
    rightPriceScale: {
      borderColor: "rgba(180, 180, 180, 1)",
    },
    timeScale: {
      borderColor: "rgba(180, 180, 180, 1)",
      timeVisible: true,
      secondsVisible: false,
    },
  });

  const candleSeries = chart.addCandlestickSeries({
    upColor: "#26a69a",
    borderUpColor: "#26a69a",
    wickUpColor: "#26a69a",
    downColor: "#ef5350",
    borderDownColor: "#ef5350",
    wickDownColor: "#ef5350",
  });

  // ---------------- Demo boshlang‘ich ma’lumotlar ----------------
  let candles = [];
  let time = Math.floor(Date.now() / 1000);
  let price = 100;
  for (let i = 0; i < 50; i++) {
    const open = price;
    const close = open + (Math.random() - 0.5) * 5;
    const high = Math.max(open, close) + Math.random() * 2;
    const low = Math.min(open, close) - Math.random() * 2;
    candles.push({ time, open, high, low, close });
    time += 60;
    price = close;
  }
  candleSeries.setData(candles);

  // ---------------- Firebase signalni o‘qish ----------------
  let tradeSignal = "buy"; // default

  const tradeRef = ref(db, "trade/trade");
  onValue(tradeRef, (snapshot) => {
    const val = snapshot.val();
    if (val) {
      tradeSignal = val.toLowerCase();
      console.log("Firebase signal:", tradeSignal);
    }
  });

  // ---------------- Real-time candle harakati ----------------
  setInterval(() => {
    // Eski candle larni siljitish
    candles.shift();

    const open = candles[candles.length - 1].close;
    let close;

    // Firebase'dagi signalga qarab yo‘nalish
    if (tradeSignal === "buy") {
      close = open + Math.random() * 2; // yuqoriga
    } else if (tradeSignal === "sell") {
      close = open - Math.random() * 2; // pastga
    } else {
      close = open + (Math.random() - 0.5) * 1; // neytral
    }

    const high = Math.max(open, close) + Math.random() * 1;
    const low = Math.min(open, close) - Math.random() * 1;
    const newCandle = { time, open, high, low, close };
    time += 60;

    candles.push(newCandle);
    candleSeries.setData(candles);
  }, 1000);
</script>
</head>
<body>
  <div id="chart"></div>
</body>
</html>
